<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Workflow runner • tessiflow</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Workflow runner">
<meta name="description" content="tessiflow handles running R scripts at given times or based on a dependency tree, and manages server load.">
<meta property="og:description" content="tessiflow handles running R scripts at given times or based on a dependency tree, and manages server load.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">tessiflow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-developer" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Developer</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-developer">
<li><a class="dropdown-item" href="../dataAtBAM/index.html">data @ BAM</a></li>
    <li><a class="dropdown-item" href="../tessireport/index.html">tessireport</a></li>
    <li><a class="dropdown-item" href="../tessistream/index.html">tessistream</a></li>
    <li><a class="dropdown-item" href="../tessilake/index.html">tessilake</a></li>
    <li><a class="dropdown-item" href="../tessiflow/index.html">tessiflow</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">

<!-- badges: start -->

<!-- badges: end -->
<p><code>tessiflow</code> is a workflow runner that handles scheduling R scripts and other commands on a given schedule, and with conditional and dependency checks. The syntax is based on a simplified version of Github Actions yml files. Each workflow is run in a separate <code>callr</code> subprocess so that all jobs/steps have access to the previous results. The motivation is to allow complex workflow dependencies while maintaining transparency and to encourage modular, testable code, because steps are by default, just R function calls.</p>
<p><em>Why not use Airflow or a similar existing workflow tool?</em></p>
<ul>
<li>Because this is an R-native workflow tool there will be less disk i/o required between steps because data can remain in memory. It is also more straightforward to collect rich error and trace information and offers the possibility of remote debugging. Also, orchestrators are complicated and this is designed to be very very simple!</li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the latest version of this package by entering the following in R:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"remotes"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>remotes<span class="sc">::</span>install <span class="fu">github</span>(<span class="st">"skysyzygy/tessiflow"</span>)</span></code></pre></div>
<p>Install miniconda using the helpers in the reticulate package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">install_miniconda</span>(PATH_TO_INSTALL)</span></code></pre></div>
<p>If miniconda is installed in a non-default location, set an environment variable <code>RETICULATE_MINICONDA_PATH</code> to the location of the install.</p>
<p>Create a yml file in your R_USER directory called <code>config.yml</code> and add the following keys to it, filling in information for your particular machine configuration:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>default<span class="sc">:</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co"># tessiflow settings</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  tessiflow.d<span class="sc">:</span> path to directory of yml files</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  tessiflow.log<span class="sc">:</span> path to directory <span class="cf">for</span> log files</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  tessiflow.debug<span class="sc">:</span> path to directory <span class="cf">for</span> debug files</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  tessiflow.port<span class="sc">:</span> port to use <span class="cf">for</span> communicating with the main tessiflow instance</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  tessiflow.email<span class="sc">:</span> email address where errors will be sent </span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>                   (first email address will also be the sender)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  tessiflow.smtp<span class="sc">:</span> </span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    <span class="sc">-</span> host.name<span class="sc">:</span> smtp host name</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    <span class="sc">-</span> port<span class="sc">:</span> optional port</span></code></pre></div>
<p>In the tessiflow.d directory, create yml files (see format info below)</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(tessiflow)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">flows_parse</span>() </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># returns a data.table of jobs parsed from the tessiflow.d yml files</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="fu">tessiflow_run</span>()</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># ... starts the scheduler</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="fu">tessiflow_stop</span>()</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co"># ... stops the scheduler</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="fu">tessiflow_job_start</span>(flow name,job name)</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co"># immediately starts the job with the given flow and job name </span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="fu">tessiflow_job_start</span>(flow name,job name)</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co"># immediately stops the job with the given flow and job name </span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="fu">tessiflow_enable</span>()</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co"># enables a scheduled task for the tessiflow scheduler using schtasks.exe on Windows or cron on *nix/Mac</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="fu">tessiflow_disable</span>()</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co"># removes the scheduled task for the tessiflow scheduler</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tessiflow-yml-format">tessiflow yml format<a class="anchor" aria-label="anchor" href="#tessiflow-yml-format"></a>
</h2>
<ul>
<li><p><code>name</code> The name of your task</p></li>
<li>
<p><code>on.schedule</code>: You can use on.schedule to define a time schedule for your workflows. You can schedule a workflow to run at specific UTC times using POSIX cron syntax.</p>
<p><strong>Example:</strong> This example triggers the workflow every day at 5:30 and 17:30 UTC:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="at">  </span><span class="fu">schedule</span><span class="kw">:</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">  # * is a special character in YAML so you have to quote this string</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">cron</span><span class="kw">:</span><span class="at">  </span><span class="st">'30 5,17 * * *'</span></span></code></pre></div>
</li>
<li><p><code>env</code>: A <code>map</code> of environment variables that are available to the steps of all jobs in the workflow.</p></li>
<li>
<p><code>jobs</code>: A workflow run is made up of one or more jobs, which run in parallel by default. To run jobs sequentially, you can define dependencies on other jobs using the <code>jobs.&lt;job_id&gt;.needs</code> keyword.</p>
<ul>
<li>
<p><code>&lt;job_id&gt;</code>: Use <code>&lt;job_id&gt;</code> to give your job a unique identifier. The key <code>job id</code> is a string and its value is a map of the job’s configuration data.</p>
<ul>
<li><p><code>name</code>: Use <code>name</code> to set a name for the job</p></li>
<li><p><code>timeout-minutes</code>: The maximum number of minutes to let a job run before tessiflow automatically cancels it. Default: 360</p></li>
<li><p><code>debug</code>: true/false, whether to enable interactive debugging on error</p></li>
<li>
<p><code>needs</code>: Use <code>needs</code> to identify any jobs that must complete successfully before this job will run. It can be a string or array of strings.</p>
<p><strong>Example:</strong> Requiring successful dependent jobs</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="at">  </span><span class="fu">job1</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="at">  </span><span class="fu">job2</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="at">    </span><span class="fu">needs</span><span class="kw">:</span><span class="at"> job1 </span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="at">  </span><span class="fu">job3</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="at">    </span><span class="fu">needs</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">job1</span><span class="kw">,</span><span class="at"> job2</span><span class="kw">]</span><span class="at"> </span></span></code></pre></div>
<p>In this example, job1 must complete successfully before job2 begins, and job3 waits for both job1 and job2 to complete.</p>
<p>The jobs in this example run sequentially</p>
<p><strong>Example:</strong> Not requiring successful dependent jobs</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="at">  </span><span class="fu">job1</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="at">  </span><span class="fu">job2</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="at">    </span><span class="fu">needs</span><span class="kw">:</span><span class="at"> job1 </span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="at">  </span><span class="fu">job3</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="at">    </span><span class="fu">if</span><span class="kw">:</span><span class="at"> </span><span class="ch">TRUE</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="at">    </span><span class="fu">needs</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">job1</span><span class="kw">,</span><span class="at"> job2</span><span class="kw">]</span><span class="at"> </span></span></code></pre></div>
<p>In this example, job3 uses the expression <code>TRUE</code>, which can be any R statement, so that it always runs after job1 and job2 have completed, regardless of whether they were successful.</p>
</li>
<li><p><code>if</code> You can use the <code>if</code> conditional to prevent a job from running unless a condition is met.</p></li>
<li><p><code>runs-on</code> Use <code>runs-on</code> to define the name of the machine or machines to run the job on.</p></li>
<li>
<p><code>steps</code> A job contains a sequence of tasks called steps.</p>
<ul>
<li><p><code>if</code> You can use the <code>if</code> conditional to prevent a step from running unless a condition is met.</p></li>
<li><p><code>name</code> A name for your step</p></li>
<li><p><code>env</code> Sets environment variables for steps to use</p></li>
<li><p><code>run</code> Runs command-line programs using the operating system’s shell. If you do not provide a name, the step name will default to the text specified in the <code>run</code> command.</p></li>
<li><p><code>shell</code> You can set the shell value to a template string using <code>command [options] {0} [more options]</code>. tessiflow interprets the first whitespace-delimited word of the string as the command, and inserts the file name for the temporary script at <code>{0}</code>.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Sky Syzygy <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/JANE" s-orcid-id target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/skysyzygy/tessiflow/actions" class="external-link"><img src="https://github.com/skysyzygy/tessiflow/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/gh/skysyzygy/tessiflow?branch=master" class="external-link"><img src="https://codecov.io/gh/skysyzygy/tessiflow/branch/master/graph/badge.svg?token=KDSM648X28" alt="Codecov test coverage"></a></li>
</ul>
</div>

<div class="table-of-contents">
<h2 data-toc-skip>Table of contents</h2>
<ul class="list-unstyled">
<li><nav id="toc"></nav></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sky Syzygy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>



  <script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: false });
  mermaid.run({
    querySelector: '.mermaid code',
  });

  jQuery("pre.mermaid code").on("click", (e) => jQuery(e.currentTarget).toggleClass("svg-modal"))
</script>
</body>
</html>
